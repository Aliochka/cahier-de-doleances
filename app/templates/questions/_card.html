<article class="media question-card">
  <div class="media__body">
    {# Titre sans lien, garde le highlight si présent #}
    {% set title_html =
         (q.prompt_hl|safe) if q.prompt_hl is defined and q.prompt_hl
         else (q.title if q.title is defined and q.title
         else q.prompt) %}
    <h3 class="h3">{{ title_html }}</h3>

    {% if q.answers %}
    <ul class="question-preview">
        {% for a in q.answers[:3] %}
        {% if a.author_id %}
        {% set contrib_url = (url_for('author_detail', author_id=a.author_id)|string) ~ '#answer-' ~ a.id %}
        {% else %}
        {% set contrib_url = (url_for('question_detail', question_id=q.id)|string) ~ '#answer-' ~ a.id %}
        {% endif %}

        <li class="question-preview__item" id="preview-{{ a.id }}">
        <figure class="quote">
            <blockquote class="quote__text clamp-3">
            {{ a.text }}{% if a.is_truncated %}…{% endif %}
            </blockquote>
            <figcaption class="quote__meta">
            <a class="quote__link" href="{{ contrib_url }}">→ Voir la contribution</a>
            </figcaption>
        </figure>
        </li>

        {% endfor %}
    </ul>
    {% endif %}


    <div class="question-card__actions" style="margin-top: var(--space-3);">
      <a class="badge badge--link" href="{{ url_for('question_detail', question_id=q.id) }}">
        Voir toutes les réponses
      </a>
    </div>
  </div>
</article>
